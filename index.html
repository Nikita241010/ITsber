<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π —Å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 320px 1fr 300px;
            gap: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
            grid-column: 1 / -1;
        }

        h1 {
            margin-bottom: 15px;
        }

        .status-message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .filters-section {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .filter-group {
            margin-bottom: 20px;
        }

        .filter-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .filter-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            background-color: white;
        }

        .filter-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .calendar-section {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .calendar-nav {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: #3498db;
            padding: 3px 8px;
        }

        .calendar-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            padding: 8px 0;
            color: #2c3e50;
            font-size: 12px;
        }

        .calendar-day {
            text-align: center;
            padding: 8px 2px;
            border-radius: 5px;
            cursor: pointer;
            position: relative;
            font-size: 14px;
        }

        .calendar-day:hover {
            background-color: #ecf0f1;
        }

        .calendar-day.empty {
            background-color: transparent;
            cursor: default;
        }

        .calendar-day.today {
            background-color: #3498db;
            color: white;
        }

        .calendar-day.has-events::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background-color: #e74c3c;
            border-radius: 50%;
        }

        .calendar-day.multiple-events::after {
            background-color: #e74c3c;
            width: 6px;
            height: 6px;
        }

        .events-section {
            display: flex;
            flex-direction: column;
        }

        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .event-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .event-date {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 8px;
        }

        .event-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            line-height: 1.4;
        }

        .event-location {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        .event-participation {
            font-size: 12px;
            margin-top: 8px;
            padding: 3px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .participation-speaker {
            background-color: #e74c3c;
            color: white;
        }

        .participation-listener {
            background-color: #3498db;
            color: white;
        }

        .participation-both {
            background-color: #27ae60;
            color: white;
        }

        .event-stats {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            font-size: 12px;
        }

        .stat-item {
            background-color: #f8f9fa;
            padding: 4px 8px;
            border-radius: 8px;
            color: #6c757d;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }

        .event-detail {
            margin-bottom: 15px;
        }

        .event-detail-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .event-detail-value {
            color: #34495e;
        }

        .no-events {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 18px;
            grid-column: 1 / -1;
        }

        .calendar-events {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 14px;
        }

        .calendar-event-item {
            padding: 8px;
            border-bottom: 1px solid #ecf0f1;
            cursor: pointer;
        }

        .calendar-event-item:hover {
            background-color: #f8f9fa;
        }

        .calendar-event-date {
            font-size: 11px;
            color: #7f8c8d;
        }

        .calendar-event-title {
            font-weight: 500;
            margin-top: 3px;
            font-size: 13px;
        }

        .reset-filters {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            width: 100%;
            margin-top: 10px;
        }

        .reset-filters:hover {
            background-color: #2980b9;
        }

        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 280px 1fr 250px;
            }
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .calendar-section {
                order: 3;
            }
            
            .filters-section {
                order: 1;
            }
            
            .events-section {
                order: 2;
            }
        }

        @media (max-width: 768px) {
            .events-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π —Å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º</h1>
        <div id="statusMessage" class="status-message">
            –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
        </div>
    </header>

    <div class="container">
        <section class="filters-section">
            <h2>–§–∏–ª—å—Ç—Ä—ã —Å–æ–±—ã—Ç–∏–π</h2>
            <div class="filter-group">
                <label class="filter-label" for="monthFilter">–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –Ω–∞:</label>
                <select class="filter-select" id="monthFilter">
                    <option value="1">–ë–ª–∏–∂–∞–π—à–∏–π –º–µ—Å—è—Ü</option>
                    <option value="3" selected>–ë–ª–∏–∂–∞–π—à–∏–µ 3 –º–µ—Å—è—Ü–∞</option>
                    <option value="6">–ë–ª–∏–∂–∞–π—à–∏–µ 6 –º–µ—Å—è—Ü–µ–≤</option>
                    <option value="12">–ë–ª–∏–∂–∞–π—à–∏–π –≥–æ–¥</option>
                    <option value="all">–í—Å–µ —Å–æ–±—ã—Ç–∏—è</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label" for="formatFilter">–§–æ—Ä–º–∞—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:</label>
                <select class="filter-select" id="formatFilter">
                    <option value="all">–í—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã</option>
                    <option value="–û—Ñ–ª–∞–π–Ω">–û—Ñ–ª–∞–π–Ω</option>
                    <option value="–û–Ω–ª–∞–π–Ω">–û–Ω–ª–∞–π–Ω</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label" for="participationFilter">–§–æ—Ä–º–∞—Ç —É—á–∞—Å—Ç–∏—è:</label>
                <select class="filter-select" id="participationFilter">
                    <option value="all">–õ—é–±–æ–µ —É—á–∞—Å—Ç–∏–µ</option>
                    <option value="—Å–ø–∏–∫–µ—Ä">–ö–∞–∫ —Å–ø–∏–∫–µ—Ä</option>
                    <option value="—Å–ª—É—à–∞—Ç–µ–ª—å">–ö–∞–∫ —Å–ª—É—à–∞—Ç–µ–ª—å</option>
                    <option value="—Å–ø–∏–∫–µ—Ä/—Å–ª—É—à–∞—Ç–µ–ª—å">–°–ø–∏–∫–µ—Ä/—Å–ª—É—à–∞—Ç–µ–ª—å</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label" for="participantsFilter">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</label>
                <select class="filter-select" id="participantsFilter">
                    <option value="all">–õ—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</option>
                    <option value="small">–ú–∞–ª–µ–Ω—å–∫–æ–µ (–¥–æ 100)</option>
                    <option value="medium">–°—Ä–µ–¥–Ω–µ–µ (100-1000)</option>
                    <option value="large">–ë–æ–ª—å—à–æ–µ (–æ—Ç 1000)</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label" for="speakersFilter">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–∏–∫–µ—Ä–æ–≤:</label>
                <select class="filter-select" id="speakersFilter">
                    <option value="all">–õ—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</option>
                    <option value="small">–ú–∞–ª–µ–Ω—å–∫–æ–µ (–¥–æ 10)</option>
                    <option value="medium">–°—Ä–µ–¥–Ω–µ–µ (10-30)</option>
                    <option value="large">–ë–æ–ª—å—à–æ–µ (–æ—Ç 30)</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label" for="locationFilter">–ì–æ—Ä–æ–¥ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</label>
                <input type="text" class="filter-input" id="locationFilter" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥...">
            </div>
            <button class="reset-filters" id="resetFiltersBtn">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
        </section>

        <section class="events-section">
            <h2>–°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π</h2>
            <div class="events-grid" id="eventsGrid">
                <div class="no-events">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π...</div>
            </div>
        </section>

        <section class="calendar-section">
            <div class="calendar-header">
                <button class="calendar-nav" id="prevMonthBtn">&lt;</button>
                <div class="calendar-title" id="currentMonthYear">–ú–µ—Å—è—Ü –ì–æ–¥</div>
                <button class="calendar-nav" id="nextMonthBtn">&gt;</button>
            </div>
            <div class="calendar-grid" id="calendarGrid">
                <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>
            <div class="calendar-events" id="calendarEvents">
                <!-- –°–æ–±—ã—Ç–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>
        </section>
    </div>

    <div class="modal" id="eventModal">
        <div class="modal-content">
            <span class="close-btn" id="closeModalBtn">&times;</span>
            <div id="modalContent">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å—é–¥–∞ -->
            </div>
        </div>
    </div>

    <script>
        let eventsData = [];
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        let filteredEvents = [];

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const eventsGrid = document.getElementById('eventsGrid');
        const eventModal = document.getElementById('eventModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const modalContent = document.getElementById('modalContent');
        const statusMessage = document.getElementById('statusMessage');
        const calendarGrid = document.getElementById('calendarGrid');
        const currentMonthYear = document.getElementById('currentMonthYear');
        const prevMonthBtn = document.getElementById('prevMonthBtn');
        const nextMonthBtn = document.getElementById('nextMonthBtn');
        const calendarEvents = document.getElementById('calendarEvents');
        const monthFilter = document.getElementById('monthFilter');
        const formatFilter = document.getElementById('formatFilter');
        const participationFilter = document.getElementById('participationFilter');
        const participantsFilter = document.getElementById('participantsFilter');
        const speakersFilter = document.getElementById('speakersFilter');
        const locationFilter = document.getElementById('locationFilter');
        const resetFiltersBtn = document.getElementById('resetFiltersBtn');

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å—Ç–∞—Ç—É—Å–∞
        function showStatus(message, isError = false) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
        }

        // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ CSV
        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim() !== '');
            if (lines.length === 0) return [];
            
            // –ü–æ–ª—É—á–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
            const headers = lines[0].split(',').map(header => header.trim());
            
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i];
                const obj = {};
                let currentIndex = 0;
                let insideQuotes = false;
                let currentValue = '';
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    
                    if (char === '"') {
                        insideQuotes = !insideQuotes;
                    } else if (char === ',' && !insideQuotes) {
                        // –ó–∞–≤–µ—Ä—à–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                        if (headers[currentIndex]) {
                            obj[headers[currentIndex]] = currentValue.trim();
                        }
                        currentValue = '';
                        currentIndex++;
                    } else {
                        currentValue += char;
                    }
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                if (headers[currentIndex]) {
                    obj[headers[currentIndex]] = currentValue.trim();
                }
                
                data.push(obj);
            }
            
            return data;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –≤ –æ–±—ä–µ–∫—Ç Date
        function parseDate(dateString) {
            // –°–ª–æ–≤–∞—Ä—å –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ä—É—Å—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –º–µ—Å—è—Ü–µ–≤
            const monthMapping = {
                '—è–Ω–≤–∞—Ä—è': 0, '—Ñ–µ–≤—Ä–∞–ª—è': 1, '–º–∞—Ä—Ç–∞': 2, '–∞–ø—Ä–µ–ª—è': 3,
                '–º–∞—è': 4, '–∏—é–Ω—è': 5, '–∏—é–ª—è': 6, '–∞–≤–≥—É—Å—Ç–∞': 7,
                '—Å–µ–Ω—Ç—è–±—Ä—è': 8, '–æ–∫—Ç—è–±—Ä—è': 9, '–Ω–æ—è–±—Ä—è': 10, '–¥–µ–∫–∞–±—Ä—è': 11
            };

            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç
            if (dateString.includes('-')) {
                const parts = dateString.split(' ');
                const dayRange = parts[0].split('-');
                const monthName = parts[1];
                const year = parseInt(parts[2]);
                
                const month = monthMapping[monthName];
                const startDay = parseInt(dayRange[0]);
                const endDay = parseInt(dayRange[1]);
                
                return {
                    startDate: new Date(year, month, startDay),
                    endDate: new Date(year, month, endDay),
                    isRange: true
                };
            } else {
                // –ï—Å–ª–∏ –æ–¥–Ω–∞ –¥–∞—Ç–∞
                const parts = dateString.split(' ');
                const day = parseInt(parts[0]);
                const monthName = parts[1];
                const year = parseInt(parts[2]);
                
                const month = monthMapping[monthName];
                const date = new Date(year, month, day);
                
                return {
                    startDate: date,
                    endDate: date,
                    isRange: false
                };
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –∏–∑ –º–µ—Å—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è
        function extractCity(locationString) {
            if (!locationString) return '';
            
            // –†–∞–∑–¥–µ–ª—è–µ–º –ø–æ –∑–∞–ø—è—Ç–æ–π –∏ –±–µ—Ä–µ–º –ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å (–≥–æ—Ä–æ–¥)
            const parts = locationString.split(',');
            return parts[0].trim();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —É—á–∞—Å—Ç–∏—è
        function parseParticipation(participationString) {
            if (!participationString) return [];
            
            const normalized = participationString.toLowerCase();
            const roles = [];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ä–æ–ª–µ–π –≤ —Å—Ç—Ä–æ–∫–µ
            if (normalized.includes('—Å–ø–∏–∫–µ—Ä')) {
                roles.push('—Å–ø–∏–∫–µ—Ä');
            }
            if (normalized.includes('—Å–ª—É—à–∞—Ç–µ–ª—å')) {
                roles.push('—Å–ª—É—à–∞—Ç–µ–ª—å');
            }
            
            return roles;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–∏–ø–∞ —É—á–∞—Å—Ç–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function getParticipationType(participationString) {
            const roles = parseParticipation(participationString);
            
            if (roles.includes('—Å–ø–∏–∫–µ—Ä') && roles.includes('—Å–ª—É—à–∞—Ç–µ–ª—å')) {
                return {
                    type: 'both',
                    text: '–°–ø–∏–∫–µ—Ä/–°–ª—É—à–∞—Ç–µ–ª—å',
                    class: 'participation-both'
                };
            } else if (roles.includes('—Å–ø–∏–∫–µ—Ä')) {
                return {
                    type: 'speaker',
                    text: '–°–ø–∏–∫–µ—Ä',
                    class: 'participation-speaker'
                };
            } else if (roles.includes('—Å–ª—É—à–∞—Ç–µ–ª—å')) {
                return {
                    type: 'listener',
                    text: '–°–ª—É—à–∞—Ç–µ–ª—å',
                    class: 'participation-listener'
                };
            } else {
                return null;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤/—Å–ø–∏–∫–µ—Ä–æ–≤
        function parseCount(countString) {
            if (!countString) return null;
            
            // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä
            const cleanString = countString.replace(/\s/g, '').toLowerCase();
            
            // –ï—Å–ª–∏ —ç—Ç–æ –¥–∏–∞–ø–∞–∑–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, "100-200")
            if (cleanString.includes('-')) {
                const parts = cleanString.split('-');
                const min = parseInt(parts[0]);
                const max = parseInt(parts[1]);
                
                if (!isNaN(min) && !isNaN(max)) {
                    return {
                        min: min,
                        max: max,
                        average: Math.round((min + max) / 2)
                    };
                }
            }
            
            // –ï—Å–ª–∏ —ç—Ç–æ –æ–¥–Ω–æ —á–∏—Å–ª–æ
            const singleNumber = parseInt(cleanString);
            if (!isNaN(singleNumber)) {
                return {
                    min: singleNumber,
                    max: singleNumber,
                    average: singleNumber
                };
            }
            
            return null;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
        function getCategory(count, type) {
            if (!count || !count.average) return null;
            
            const average = count.average;
            
            if (type === 'participants') {
                if (average < 100) return 'small';
                if (average <= 1000) return 'medium';
                return 'large';
            } else if (type === 'speakers') {
                if (average < 10) return 'small';
                if (average <= 30) return 'medium';
                return 'large';
            }
            
            return null;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
        function filterEvents() {
            const monthValue = monthFilter.value;
            const formatValue = formatFilter.value;
            const participationValue = participationFilter.value;
            const participantsValue = participantsFilter.value;
            const speakersValue = speakersFilter.value;
            const locationValue = locationFilter.value.trim().toLowerCase();
            const today = new Date();
            today.setHours(0, 0, 0, 0); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª–æ –¥–Ω—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
            
            filteredEvents = eventsData.filter(event => {
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ñ–æ—Ä–º–∞—Ç—É
                if (formatValue !== 'all') {
                    const eventFormat = event.—Ñ–æ—Ä–º–∞—Ç || event['—Ñ–æ—Ä–º–∞—Ç'] || '';
                    if (eventFormat !== formatValue) {
                        return false;
                    }
                }
                
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ñ–æ—Ä–º–∞—Ç—É —É—á–∞—Å—Ç–∏—è
                if (participationValue !== 'all') {
                    const eventParticipation = event.—É—á–∞—Å—Ç–∏–µ || event['—É—á–∞—Å—Ç–∏–µ'] || '';
                    const participationRoles = parseParticipation(eventParticipation);
                    
                    if (participationValue === '—Å–ø–∏–∫–µ—Ä/—Å–ª—É—à–∞—Ç–µ–ª—å') {
                        // –î–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ "—Å–ø–∏–∫–µ—Ä/—Å–ª—É—à–∞—Ç–µ–ª—å" –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –±—ã–ª–∏ –æ–±–µ —Ä–æ–ª–∏
                        if (!participationRoles.includes('—Å–ø–∏–∫–µ—Ä') || !participationRoles.includes('—Å–ª—É—à–∞—Ç–µ–ª—å')) {
                            return false;
                        }
                    } else {
                        // –î–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ä–æ–ª–µ–π –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –Ω—É–∂–Ω–æ–π —Ä–æ–ª–∏
                        if (!participationRoles.includes(participationValue)) {
                            return false;
                        }
                    }
                }
                
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                if (participantsValue !== 'all') {
                    const eventParticipants = event.–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ || event['–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤'] || '';
                    const participantsCount = parseCount(eventParticipants);
                    const participantsCategory = getCategory(participantsCount, 'participants');
                    
                    if (participantsCategory !== participantsValue) {
                        return false;
                    }
                }
                
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–ø–∏–∫–µ—Ä–æ–≤
                if (speakersValue !== 'all') {
                    const eventSpeakers = event.–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Å–ø–∏–∫–µ—Ä–æ–≤ || event['–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Å–ø–∏–∫–µ—Ä–æ–≤'] || '';
                    const speakersCount = parseCount(eventSpeakers);
                    const speakersCategory = getCategory(speakersCount, 'speakers');
                    
                    if (speakersCategory !== speakersValue) {
                        return false;
                    }
                }
                
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≥–æ—Ä–æ–¥—É
                if (locationValue !== '') {
                    const eventLocation = event.–º–µ—Å—Ç–æ_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è || event['–º–µ—Å—Ç–æ_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è'] || '';
                    const eventCity = extractCity(eventLocation).toLowerCase();
                    
                    if (!eventCity.includes(locationValue)) {
                        return false;
                    }
                }
                
                const eventDate = parseDate(event.–¥–∞—Ç–∞_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è || event['–¥–∞—Ç–∞_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è']);
                
                // –î–ª—è –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∫—Ä–æ–º–µ "all" –∏—Å–∫–ª—é—á–∞–µ–º –ø—Ä–æ—à–µ–¥—à–∏–µ —Å–æ–±—ã—Ç–∏—è
                if (monthValue !== 'all') {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –µ—â–µ –Ω–µ –ø—Ä–æ—à–ª–æ (–∫–æ–Ω–µ—Ü —Å–æ–±—ã—Ç–∏—è –≤ –±—É–¥—É—â–µ–º)
                    if (eventDate.endDate < today) {
                        return false;
                    }
                }
                
                // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º
                if (monthValue === 'all') {
                    return true;
                }
                
                const monthsAhead = parseInt(monthValue);
                const futureDate = new Date();
                futureDate.setMonth(today.getMonth() + monthsAhead);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–ø–∞–¥–∞–µ—Ç –ª–∏ —Å–æ–±—ã—Ç–∏–µ –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
                return eventDate.startDate <= futureDate;
            });
            
            displayEvents(filteredEvents);
            generateCalendar();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
        function displayEvents(events) {
            eventsGrid.innerHTML = '';
            
            if (events.length === 0) {
                eventsGrid.innerHTML = '<div class="no-events">–°–æ–±—ã—Ç–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }
            
            events.forEach(event => {
                const eventCard = document.createElement('div');
                eventCard.className = 'event-card';
                
                const location = event.–º–µ—Å—Ç–æ_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è || event['–º–µ—Å—Ç–æ_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è'] || '';
                const city = extractCity(location);
                const participation = event.—É—á–∞—Å—Ç–∏–µ || event['—É—á–∞—Å—Ç–∏–µ'] || '';
                const participationInfo = getParticipationType(participation);
                
                const participants = event.–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ || event['–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤'] || '';
                const speakers = event.–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Å–ø–∏–∫–µ—Ä–æ–≤ || event['–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Å–ø–∏–∫–µ—Ä–æ–≤'] || '';
                
                let participationHTML = '';
                if (participationInfo) {
                    participationHTML = `<div class="event-participation ${participationInfo.class}">${participationInfo.text}</div>`;
                }
                
                let statsHTML = '';
                if (participants || speakers) {
                    statsHTML = `
                        <div class="event-stats">
                            ${participants ? `<div class="stat-item">üë• ${participants}</div>` : ''}
                            ${speakers ? `<div class="stat-item">üé§ ${speakers}</div>` : ''}
                        </div>
                    `;
                }
                
                eventCard.innerHTML = `
                    <div class="event-date">${event.–¥–∞—Ç–∞_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è || event['–¥–∞—Ç–∞_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è']}</div>
                    <div class="event-title">${event.–Ω–∞–∑–≤–∞–Ω–∏–µ || event['–Ω–∞–∑–≤–∞–Ω–∏–µ']}</div>
                    <div class="event-location">${city}</div>
                    ${participationHTML}
                    ${statsHTML}
                `;
                
                eventCard.addEventListener('click', () => showEventDetails(event));
                eventsGrid.appendChild(eventCard);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –¥–µ—Ç–∞–ª–µ–π —Å–æ–±—ã—Ç–∏—è
        function showEventDetails(event) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–≤–æ–π—Å—Ç–≤–∞–º
            const title = event.–Ω–∞–∑–≤–∞–Ω–∏–µ || event['–Ω–∞–∑–≤–∞–Ω–∏–µ'] || '–ù–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è';
            const date = event.–¥–∞—Ç–∞_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è || event['–¥–∞—Ç–∞_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è'] || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
            const location = event.–º–µ—Å—Ç–æ_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è || event['–º–µ—Å—Ç–æ_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è'] || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            const description = event.–∫—Ä–∞—Ç–∫–æ–µ_–æ–ø–∏—Å–∞–Ω–∏–µ || event['–∫—Ä–∞—Ç–∫–æ–µ_–æ–ø–∏—Å–∞–Ω–∏–µ'] || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è';
            const format = event.—Ñ–æ—Ä–º–∞—Ç || event['—Ñ–æ—Ä–º–∞—Ç'] || '–ù–µ —É–∫–∞–∑–∞–Ω';
            const participants = event.–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ || event['–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤'] || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            const speakers = event.–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Å–ø–∏–∫–µ—Ä–æ–≤ || event['–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Å–ø–∏–∫–µ—Ä–æ–≤'] || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            const participation = event.—É—á–∞—Å—Ç–∏–µ || event['—É—á–∞—Å—Ç–∏–µ'] || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            
            modalContent.innerHTML = `
                <h2>${title}</h2>
                <div class="event-detail">
                    <div class="event-detail-label">–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</div>
                    <div class="event-detail-value">${date}</div>
                </div>
                <div class="event-detail">
                    <div class="event-detail-label">–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</div>
                    <div class="event-detail-value">${location}</div>
                </div>
                <div class="event-detail">
                    <div class="event-detail-label">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:</div>
                    <div class="event-detail-value">${description}</div>
                </div>
                <div class="event-detail">
                    <div class="event-detail-label">–§–æ—Ä–º–∞—Ç:</div>
                    <div class="event-detail-value">${format}</div>
                </div>
                <div class="event-detail">
                    <div class="event-detail-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</div>
                    <div class="event-detail-value">${participants}</div>
                </div>
                <div class="event-detail">
                    <div class="event-detail-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ø–∏–∫–µ—Ä–æ–≤:</div>
                    <div class="event-detail-value">${speakers}</div>
                </div>
                <div class="event-detail">
                    <div class="event-detail-label">–£—á–∞—Å—Ç–∏–µ:</div>
                    <div class="event-detail-value">${participation}</div>
                </div>
            `;
            
            eventModal.style.display = 'flex';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
        function generateCalendar() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞
            const monthNames = [
                '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
            ];
            currentMonthYear.textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            // –û—á–∏—â–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
            calendarGrid.innerHTML = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
            const dayNames = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1; // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–ª—è –¥–Ω–µ–π –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarGrid.appendChild(emptyDay);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–Ω–∏ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥–µ–Ω—å —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–º
                if (currentYear === today.getFullYear() && 
                    currentMonth === today.getMonth() && 
                    day === today.getDate()) {
                    dayElement.classList.add('today');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ–±—ã—Ç–∏—è –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å
                const date = new Date(currentYear, currentMonth, day);
                const eventsOnDay = getEventsOnDate(date);
                
                if (eventsOnDay.length > 0) {
                    dayElement.classList.add('has-events');
                    if (eventsOnDay.length > 1) {
                        dayElement.classList.add('multiple-events');
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–æ–±—ã—Ç–∏–π –¥–Ω—è
                    dayElement.addEventListener('click', () => showEventsForDate(date, eventsOnDay));
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –¥–∞—Ç—É
        function getEventsOnDate(date) {
            return filteredEvents.filter(event => {
                const eventDate = parseDate(event.–¥–∞—Ç–∞_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è || event['–¥–∞—Ç–∞_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è']);
                
                // –î–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç –ø—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–ø–∞–¥–∞–µ—Ç –ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω
                if (eventDate.isRange) {
                    return date >= eventDate.startDate && date <= eventDate.endDate;
                } else {
                    // –î–ª—è –æ–¥–∏–Ω–æ—á–Ω–æ–π –¥–∞—Ç—ã —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –¥–µ–Ω—å, –º–µ—Å—è—Ü –∏ –≥–æ–¥
                    return date.getDate() === eventDate.startDate.getDate() &&
                           date.getMonth() === eventDate.startDate.getMonth() &&
                           date.getFullYear() === eventDate.startDate.getFullYear();
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–æ–±—ã—Ç–∏–π –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è
        function showEventsForDate(date, events) {
            calendarEvents.innerHTML = '';
            
            if (events.length === 0) {
                calendarEvents.innerHTML = '<div style="text-align: center; padding: 10px; color: #7f8c8d; font-size: 12px;">–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å</div>';
                return;
            }
            
            const dateString = date.toLocaleDateString('ru-RU', { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric' 
            });
            
            const dateHeader = document.createElement('h3');
            dateHeader.textContent = `–°–æ–±—ã—Ç–∏—è –Ω–∞ ${dateString}`;
            dateHeader.style.fontSize = '14px';
            dateHeader.style.marginBottom = '10px';
            calendarEvents.appendChild(dateHeader);
            
            events.forEach(event => {
                const eventItem = document.createElement('div');
                eventItem.className = 'calendar-event-item';
                eventItem.innerHTML = `
                    <div class="calendar-event-date">${event.–¥–∞—Ç–∞_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è || event['–¥–∞—Ç–∞_–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è']}</div>
                    <div class="calendar-event-title">${event.–Ω–∞–∑–≤–∞–Ω–∏–µ || event['–Ω–∞–∑–≤–∞–Ω–∏–µ']}</div>
                `;
                
                eventItem.addEventListener('click', () => showEventDetails(event));
                calendarEvents.appendChild(eventItem);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ CSV —Ñ–∞–π–ª–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
        function loadCSVFromServer() {
            showStatus('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
            
            fetch('events_database.csv')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    }
                    return response.text();
                })
                .then(csvText => {
                    console.log('Raw CSV:', csvText); // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
                    eventsData = parseCSV(csvText);
                    console.log('Parsed events:', eventsData); // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
                    showStatus(`–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${eventsData.length} —Å–æ–±—ã—Ç–∏–π`);
                    filterEvents(); // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                })
                .catch(error => {
                    showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ events_database.csv –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ.', true);
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞:', error);
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function resetFilters() {
            monthFilter.value = '3';
            formatFilter.value = 'all';
            participationFilter.value = 'all';
            participantsFilter.value = 'all';
            speakersFilter.value = 'all';
            locationFilter.value = '';
            filterEvents();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
        prevMonthBtn.addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar();
        });

        nextMonthBtn.addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            generateCalendar();
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        monthFilter.addEventListener('change', filterEvents);
        formatFilter.addEventListener('change', filterEvents);
        participationFilter.addEventListener('change', filterEvents);
        participantsFilter.addEventListener('change', filterEvents);
        speakersFilter.addEventListener('change', filterEvents);
        locationFilter.addEventListener('input', filterEvents);
        resetFiltersBtn.addEventListener('click', resetFilters);

        closeModalBtn.addEventListener('click', () => {
            eventModal.style.display = 'none';
        });

        eventModal.addEventListener('click', (e) => {
            if (e.target === eventModal) {
                eventModal.style.display = 'none';
            }
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', () => {
            loadCSVFromServer();
        });
    </script>
</body>
</html>
